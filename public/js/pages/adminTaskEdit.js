(()=>{"use strict";const e=function(e){return window.location.pathname.split("/").slice(2)[e]},t=function(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},a=class{_apiBase="/api/";getResource=async(e,t)=>{const a=await fetch(e,{headers:{"X-API-KEY":"9v5-QpF?JlNlVEXux!3qu/c02G/YZKkOjX0OqZ04PssQvczStQitTeawtdrou/yyHh5/qotI!fBfBKLlnuY-EW7u6=bi/PeCujc6VnYf?m9bNS7Aa7RfXfi7aFK?!ms!RYNpTlBkD8dW-YF-G4ofTJ63sXXjKdtR9C?yMQc88D4HYu0Gj23IuqtDz7abNcJZ3l5O3!WM7WXU!ALZgbLC!PlpuoLnFa71gbuiLqhrOBIiIsye0FDOOaT3pnSZpaef"},...t});if(!a.ok)throw new Error(`Could not fetch ${e}, status: ${res.status}`);return await a.json()};getTopList=async()=>await this.getResource(`${this._apiBase}user-top5`);getGeneralList=async()=>await this.getResource(`${this._apiBase}user-top`);getLastYearList=async()=>await this.getResource(`${this._apiBase}user-lasttop`);getCurrentYearList=async()=>await this.getResource(`${this._apiBase}user-nowtop`);getTask=async e=>await this.getResource(`${this._apiBase}task/${e}`,{method:"GET",headers:{"X-API-KEY":"9v5-QpF?JlNlVEXux!3qu/c02G/YZKkOjX0OqZ04PssQvczStQitTeawtdrou/yyHh5/qotI!fBfBKLlnuY-EW7u6=bi/PeCujc6VnYf?m9bNS7Aa7RfXfi7aFK?!ms!RYNpTlBkD8dW-YF-G4ofTJ63sXXjKdtR9C?yMQc88D4HYu0Gj23IuqtDz7abNcJZ3l5O3!WM7WXU!ALZgbLC!PlpuoLnFa71gbuiLqhrOBIiIsye0FDOOaT3pnSZpaef",Authorization:`Bearer ${t("token")}`,"Content-Type":"application/json"}});getLevelsAndTasks=async()=>await this.getResource(`${this._apiBase}levels`,{method:"GET"});getHeaderUser=async()=>await this.getResource(`${this._apiBase}auth/login`,{method:"GET",headers:{"X-API-KEY":"9v5-QpF?JlNlVEXux!3qu/c02G/YZKkOjX0OqZ04PssQvczStQitTeawtdrou/yyHh5/qotI!fBfBKLlnuY-EW7u6=bi/PeCujc6VnYf?m9bNS7Aa7RfXfi7aFK?!ms!RYNpTlBkD8dW-YF-G4ofTJ63sXXjKdtR9C?yMQc88D4HYu0Gj23IuqtDz7abNcJZ3l5O3!WM7WXU!ALZgbLC!PlpuoLnFa71gbuiLqhrOBIiIsye0FDOOaT3pnSZpaef",Authorization:`Bearer ${t("token")}`,"Content-Type":"application/json"}});logout=async()=>await this.getResource(`${this._apiBase}logout`,{method:"GET"});getLkAchievements=async()=>await this.getResource(`${this._apiBase}task-user-count`,{method:"GET"});getUserAmount=async()=>await this.getResource(`${this._apiBase}admin/user-count`,{method:"GET"});getSolvedTasksAmount=async()=>await this.getResource(`${this._apiBase}admin/task-count`,{method:"GET"});getTableList=async e=>await this.getResource(`${this._apiBase}admin/${e}`,{method:"GET"});getTablePage=async(e,t)=>await this.getResource(`${this._apiBase}admin/${t}/${e}`,{method:"GET"});deleteTable=async(e,t)=>await this.getResource(`${this._apiBase}admin/${t}/${e}`,{method:"DELETE"});getSelect=async e=>await this.getResource(`${this._apiBase}admin/${e}`,{method:"GET"})},s=class{constructor({parentSelector:e,id:t,name:a,selected:s}){this.parent=document.querySelector(e),this.id=t,this.name=a,this.selected=s?"selected":""}render(){this.parent.insertAdjacentHTML("beforeend",`\n            <option ${this.selected} value="${this.id}">${this.name}</option>\n        `)}},o=class{constructor(e,t="afterend",a="К сожалению, данные отсутствуют."){this.parent=document.querySelector(e),this.position=t,this.message=a}render(){this.parent.insertAdjacentHTML(this.position,`\n            <span class="error">${this.message}</span>\n        `)}},n=function(e,t,a={}){(a={path:"/",...a}).expires instanceof Date&&(a.expires=a.expires.toUTCString());let s=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let e in a){s+="; "+e;let t=a[e];!0!==t&&(s+="="+t)}document.cookie=s};function r({modalSelector:e,modalActiveClass:t,overflow:a="hidden",hasScroll:s=!0}){const o=document.querySelector(e);let n;s&&(n=function(){let e=document.createElement("div");e.style.width="50px",e.style.height="50px",e.style.overflowY="scroll",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetWidth-e.clientWidth;return e.remove(),t}()),o.classList.add(t),document.body.style.overflow=a,document.body.style.marginRight=`${n}px`}function i({modalSelector:e,modalActiveClass:t,closeOnClickOnBg:a=!0,automatically:s=!1}){const o=document.querySelector(e);function n(){o.classList.remove(t),document.body.style.overflow="",document.body.style.marginRight=0}document.addEventListener("keydown",(e=>{"Escape"===e.code&&o.classList.contains(t)&&n()})),o.addEventListener("click",(e=>{e.target.closest(".modal__close")&&n()})),a&&document.addEventListener("click",(e=>{e.target===o&&n()})),s&&n()}const c=function({formSelector:e,url:a,modifyURL:s=!1,requestMethod:o="POST",messageSuccessSelector:c,messageErrorSelector:l,messageLoginUsedSelector:d,messageWrongDataSelector:m,modalSuccessSelector:u,modalWrongSelector:h,modalErrorSelector:g,spinnerSelector:p,hideForm:f=!0,redirect:y,cookie:_,update:S,withToken:v=!1}){const w=document.querySelector(e),L=document.querySelector(c),$=document.querySelector(l),E=document.querySelector(d),T=document.querySelector(m),k=document.querySelector(u),q=document.querySelector(h),b=document.querySelector(g),B=document.querySelector(".modal__total-result"),R="form__message_active",C=document.querySelector(p),Y="spinner-wrapper_active",A="spinner-wrapper_inactive",O=v?`Bearer ${t("token")}`:"Bearer Error";async function X(e,t){const a=await fetch(`${e}${function(){if(s){const e=document.querySelectorAll("[data-input]");let t="?";return e.forEach(((e,a)=>{a>0&&(t+="&"),t+=`${e.name}=${e.value.trim()}`})),t}return""}()}`,{headers:{Authorization:O,"X-API-KEY":"9v5-QpF?JlNlVEXux!3qu/c02G/YZKkOjX0OqZ04PssQvczStQitTeawtdrou/yyHh5/qotI!fBfBKLlnuY-EW7u6=bi/PeCujc6VnYf?m9bNS7Aa7RfXfi7aFK?!ms!RYNpTlBkD8dW-YF-G4ofTJ63sXXjKdtR9C?yMQc88D4HYu0Gj23IuqtDz7abNcJZ3l5O3!WM7WXU!ALZgbLC!PlpuoLnFa71gbuiLqhrOBIiIsye0FDOOaT3pnSZpaef"},method:o,body:t});if(console.log(a),!a.ok){const e=await a.json();if(console.log("СКАЗАНО, ЧТО:",e),400===a.status&&"The login has already been taken."===e.message)throw new Error("Логин занят");if(401===a.status&&("The selected login is invalid."===e.message||"Credentials mismatch"===e.message))throw new Error("Неверные данные");if(500===a.status)throw new Error("Ошибка сервера");throw new Error(`Произошла ошибка в запросе. Статус сервера: ${a.status}`)}const r=await a.json();if(console.log("СКАЗАНО, ЧТО:",r),!1===r.message)throw new Error("Ответ неверный");return _&&function(e){n("token",`${e.token.access_token}`,{"max-age":86400,samesite:"strict"}),n("login",`${e.data[0].login}`,{"max-age":86400,samesite:"strict"}),n("fname",`${e.data[0].fname}`,{"max-age":86400,samesite:"strict"}),n("nname",`${e.data[0].nname}`,{"max-age":86400,samesite:"strict"}),n("oname",`${e.data[0].oname}`,{"max-age":86400,samesite:"strict"}),n("group",`${e.data[0].group}`,{"max-age":86400,samesite:"strict"}),n("score",`${e.data[0].score}`,{"max-age":86400,samesite:"strict"})}(r),S&&function(e){n("fname",`${e.data.fname}`,{"max-age":86400,samesite:"strict"}),n("nname",`${e.data.nname}`,{"max-age":86400,samesite:"strict"}),n("oname",`${e.data.oname}`,{"max-age":86400,samesite:"strict"}),n("group",`${e.data.group}`,{"max-age":86400,samesite:"strict"})}(r),r}w.addEventListener("submit",(function(e){e.preventDefault(),C.classList.remove(A),C.classList.add(Y);const t=new FormData(w);X(a,t).then((e=>{console.log("УСПЕХ"),y&&(document.location.href="/"),f&&w.classList.add("form_inactive"),E&&E.classList.remove(R),$&&$.classList.remove(R),T&&T.classList.remove(R),L&&L.classList.add(R),k&&(console.log("ОТКРЫВАЕМ МОДАЛОЧКИ"),r({modalSelector:u,modalActiveClass:"modal_active"}),i({modalSelector:u,modalActiveClass:"modal_active"}),B.textContent=e.score,n("score",`${e.score}`))})).catch((e=>{console.log("ОШИБКА"),console.log(e.message),"Логин занят"===e.message&&E?E.classList.add(R):"Неверные данные"===e.message&&T?T.classList.add(R):"Ответ неверный"===e.message&&q?(r({modalSelector:h,modalActiveClass:"modal_active"}),i({modalSelector:h,modalActiveClass:"modal_active"})):"Ошибка сервера"===e.message&&b?(console.log("ЭТО ОШИБКА СЕРВЕРА"),r({modalSelector:g,modalActiveClass:"modal_active"}),i({modalSelector:g,modalActiveClass:"modal_active"})):$&&$.classList.add(R)})).finally((()=>{C.classList.remove(Y),C.classList.add(A)}))}))};document.addEventListener("DOMContentLoaded",(()=>{(function(){const t=new a,n=e(4),r=document.querySelector(".task__name"),i=document.querySelector(".form__input_name"),c=document.querySelector(".form__input_descr"),l=document.querySelector(".form__input_solution"),d=document.querySelector(".form__input_img");let m,u;!async function(){await t.getTablePage(n,"task").then((e=>{e?(r.textContent=i.value=e.data.name,c.value=e.data.task,l.value=e.data.ssql,d.value=e.data.img,m=e.data.level_id,u=e.data.base_id):new o(".task__name").render()})).catch((()=>{new o(".task__name","afterend","Произошла ошибка! Пожалуйста, попробуйте позже.").render()}))}(),t.getSelect("task-base").then((e=>{e?e.forEach((e=>{new s({parentSelector:".select-database",id:e.id,name:e.dbname,selected:u===e.dbname}).render()})):new o(".task__name").render()})).catch((()=>{new o(".task__name","afterend","Произошла ошибка! Пожалуйста, попробуйте позже.").render()})),t.getSelect("task-level").then((e=>{e?e.forEach((e=>{new s({parentSelector:".select-difficulty",id:e.id,name:e.lvl,selected:m===e.lvl}).render()})):new o(".task__name").render()})).catch((()=>{new o(".task__name","afterend","Произошла ошибка! Пожалуйста, попробуйте позже.").render()}))})(),c({formSelector:".edit__form",url:`../../../api/admin/task/${e(4)}`,modifyURL:!0,requestMethod:"PUT",messageSuccessSelector:".card-primary .form__message_success",messageErrorSelector:".card-primary .form__message_error",spinnerSelector:".card-primary .spinner-wrapper"})}))})();